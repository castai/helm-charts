apiVersion: v1
kind: ConfigMap
metadata:
  name: {{- include "gpu-metrics-exporter.config-map" . | indent 1}}
data:
{{- if not .Values.castai.clusterIdSecretRef }}
  CLUSTER_ID: {{ required "castai.clusterId must be provided" .Values.castai.clusterId | quote }}
{{- end }}
  CAST_API: {{ required "castai.apiUrl must be provided" .Values.castai.apiUrl | quote }}

{{- $config := .Values.gpuMetricsExporter.config | default dict }}
{{- $otherConfig := omit $config "CLUSTER_ID" "CAST_API"}}
{{- if $otherConfig }}
  {{- toYaml $otherConfig | nindent 2 }}
{{- end }}
