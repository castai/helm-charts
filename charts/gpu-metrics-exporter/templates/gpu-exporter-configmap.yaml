apiVersion: v1
kind: ConfigMap
metadata:
  name: {{- include "gpu-metrics-exporter.config-map" . | indent 1}}
data:

{{- $config := .Values.gpuMetricsExporter.config | default dict }}
{{- $clusterID := $.Values.castai.clusterId | default ($config.CLUSTER_ID | default "") }}
{{- $castApi := $.Values.castai.apiUrl | default ($config.CAST_API | default "") }}

{{- if $clusterID }}
  CLUSTER_ID: "{{ $clusterID }}"
{{- end }}

{{- if $castApi }}
  CAST_API: "{{ $castApi }}"
{{- end }}

{{- $otherConfig := omit $config "CLUSTER_ID" "CAST_API"}}
{{- if $otherConfig }}
  {{- toYaml $otherConfig | nindent 2 }}
{{- end }}
